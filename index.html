<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quáº£n LÃ½ Du lá»‹ch</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Quáº£n LÃ½ Du lá»‹ch">
  <link rel="apple-touch-icon" href="icon-512.png">
  <link rel="icon" href="icon-192.png" type="image/png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
  <script defer src="app.js"></script>
  <link rel="stylesheet" href="style.css">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">


  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;}
    .tab-content { display: none; margin-top: 20px; }
    .tab-content.active { display: block; }
  </style>
</head>
<body>
    <button id="menuToggle" class="menu-toggle">â˜° Menu quáº£n lÃ½ 
        <svg xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            width="1em"
            height="1em"
            style="vertical-align: middle; margin-left: 4px;">
            <path d="M12 15.6315L20.9679 10.8838L20.0321 9.11619L12 13.3685L3.9679 9.11619L3.03212 10.8838L12 15.6315Z"></path>
        </svg>
    </button>
    <nav class="menu-bar">
        <ul class="menu">
            <li class="has-submenu">
            <span onclick="toggleSubmenu(this)">ğŸ“š Tour
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    width="1em"
                    height="1em"
                    style="vertical-align: middle; margin-left: 4px;">
                    <path d="M12 15.6315L20.9679 10.8838L20.0321 9.11619L12 13.3685L3.9679 9.11619L3.03212 10.8838L12 15.6315Z"></path>
                </svg>
            </span>
            <ul class="submenu">
                <li onclick="handleThemTour()">ğŸ« ThÃªm Tour</li>
                <li onclick="handleSuaTour()">ğŸ› ï¸ Sá»­a thÃ´ng tin Tour</li>
                <li onclick="handleXoaTour()">ğŸ—‘ï¸ XÃ³a Tour</li>
            </ul>
            </li>
            <li class="has-submenu">
            <span onclick="toggleSubmenu(this)">ğŸ’â€â™‚ï¸ ThÃ nh viÃªn 
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    width="1em"
                    height="1em"
                    style="vertical-align: middle; margin-left: 4px;">
                    <path d="M12 15.6315L20.9679 10.8838L20.0321 9.11619L12 13.3685L3.9679 9.11619L3.03212 10.8838L12 15.6315Z"></path>
                </svg>
            </span>
            <ul class="submenu">
                <li onclick="handleThemThanhVien()">ğŸ™†â€â™‚ï¸ ThÃªm thÃ nh viÃªn</li>
                <li onclick="handleSuaThanhVien()">âœï¸ Sá»­a thÃ´ng tin thÃ nh viÃªn</li>
                <li onclick="handleXoaThanhVien()">ğŸ™…â€â™‚ï¸ XÃ³a thÃ nh viÃªn</li>
            </ul>
            </li>
            <li onclick="handleSuaNgay()"><span>ğŸ“† Sá»­a ngÃ y Ä‘iá»ƒm danh</span></li>
            <li onclick="location.href='thuhocphi.html'"><span>ğŸ“Š Lá»‹ch sá»­ thu há»c phÃ­</span></li>
            <li class="has-submenu">
            <span onclick="toggleSubmenu(this)">ğŸ’¾ CÆ¡ sá»Ÿ dá»¯ liá»‡u
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    width="1em"
                    height="1em"
                    style="vertical-align: middle; margin-left: 4px;">
                    <path d="M12 15.6315L20.9679 10.8838L20.0321 9.11619L12 13.3685L3.9679 9.11619L3.03212 10.8838L12 15.6315Z"></path>
                </svg>
            </span>
            <ul class="submenu">
                <li onclick="openDbModal()">âš™ï¸ Phá»¥c há»“i file dá»¯ liá»‡u</li>
                <li onclick="exportSQLite()">ğŸ“¦ Sao lÆ°u file dá»¯ liá»‡u</li>
            </ul>
            </li>
        </ul>
    </nav>

    <div class="action-buttons">   
        <button onclick="handleThu()">ğŸ’° Thu</button>
        <button onclick="handleChi()">ğŸ“… Chi</button>
    </div>


<!-- Form Chá»n file dá»¯ liá»‡u -->
<div id="dbModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>âš™ï¸ Phá»¥c há»“i file dá»¯ liá»‡u</h3>

    <!-- ğŸ”² Khung chá»©a 2 pháº§n -->

    <div>
      <h4 style="margin-top: 5px;">ğŸ“‚ Chá»n file dá»¯ liá»‡u thay tháº¿ (.db)</h4>
      <input type="file" id="dbfile" accept=".db,.sqlite" required />
    </div>
    <div class="modal-actions">
    <button class="btn-cancel" onclick="closeDbModal()">ğŸ”™ Huá»·</button>
    </div>
  </div>
</div>


  <div id="tabs"></div>
  <div id="tabContents"></div>

  <!-- Form Ä‘iá»ƒm danh (áº©n ban Ä‘áº§u) -->
  <div id="chiModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ“… Khoáº£n chi</h3>

      <label>NgÃ y:
        <input type="date" id="dd-date" />
      </label>

      <label>Lá»›p:
        <select id="dd-class" onchange="loadStudentsForClass()"></select>
      </label>

      <label>Há» vÃ  tÃªn:
        <select id="dd-student"></select>
      </label>

      <div class="modal-actions">
        <button onclick="submitDiemDanh(1)">ğŸŸ¢ CÃ³</button>
        <button onclick="submitDiemDanh(0)">âŒ Nghá»‰</button>
        <button class="btn-cancel" onclick="closeDiemDanh()">ğŸ”™ Huá»·</button>
      </div>
    </div>
  </div>


  <!-- Form ThÃªm Tour -->
  <div id="themTourModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸŒ ThÃªm Tour</h3>

      <label style="color: #ff0000;">TÃªn tour: *
        <input type="text" id="tour-ten" required />
      </label>

      <label>NgÃ y Ä‘i: *
        <input type="date" id="tour-ngay-di" />
      </label>

      <label>NgÃ y vá»: *
        <input type="date" id="tour-ngay-ve" />
      </label>

      <label>Äá»‹a Ä‘iá»ƒm:
        <input type="text" id="tour-diadiem" />
      </label>

      <label>Ghi chÃº:
        <textarea id="tour-ghichu" rows="2" style="width: 100%; padding: 6px; font-size: 16px;"></textarea>
      </label>

      <div style="margin-top: 10px;">
        <label style="display: block; margin-bottom: 6px;">
          Sao chÃ©p danh sÃ¡ch thÃ nh viÃªn tá»« tour khÃ¡c:
        </label>

        <div style="display: flex; align-items: center; gap: 10px;">
          <select id="tour-copy-select" disabled style="flex: 1; padding: 6px; font-size: 18px;">
            <option value="">-- Chá»n tour Ä‘á»ƒ sao chÃ©p --</option>
          </select>

          <input type="checkbox" id="tour-copy-checkbox" onchange="toggleCopyFromTour()" title="Cho phÃ©p sao chÃ©p"
            style="width: 20px; height: 20px; flex-shrink: 0;" />
        </div>
      </div>

      <div class="modal-actions">
        <button onclick="submitThemTour()">â• LÆ°u</button>
        <button class="btn-cancel" onclick="closeThemTour()">ğŸ”™ Huá»·</button>
      </div>
    </div>
  </div>



  <!-- Form Sá»­a Tour -->
  <div id="suaTourModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ› ï¸ Sá»­a thÃ´ng tin Tour</h3>

      <label>Chá»n tour:
        <select id="edit-tour-select" onchange="loadTourInfoToForm()"></select>
      </label>

      <label>TÃªn tour:
        <input type="text" id="edit-ten-tour" />
      </label>

      <label>NgÃ y Ä‘i:
        <input type="date" id="edit-ngay-di" />
      </label>

      <label>NgÃ y vá»:
        <input type="date" id="edit-ngay-ve" />
      </label>

      <label>Äá»‹a Ä‘iá»ƒm:
        <input type="text" id="edit-diadiem-tour" />
      </label>

      <label>Ghi chÃº:
        <textarea id="edit-ghichu-tour" rows="2" style="width: 100%; padding: 6px; font-size: 16px;"></textarea>
      </label>

      <div class="modal-actions">
        <button onclick="submitSuaTour()">ğŸ› ï¸ Cáº­p nháº­t</button>
        <button class="btn-cancel" onclick="closeSuaTour()">ğŸ”™ Huá»·</button>
      </div>
    </div>
  </div>




  <!-- Form XÃ³a Tour -->
  <div id="xoaTourModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ—‘ï¸ XÃ³a Tour</h3>

      <label>Chá»n tour cáº§n xÃ³a:
        <select id="xoa-tour-select" onchange="switchTab(this.value)"></select>
      </label>

      <div class="modal-actions">
        <button onclick="submitXoaTour()">ğŸ—‘ï¸ XÃ³a</button>
        <button class="btn-cancel" onclick="closeXoaTour()">ğŸ”™ Huá»·</button>
      </div>
    </div>
  </div>



  <!-- Form ThÃªm ThÃ nh viÃªn -->
  <div id="themTvModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ™†â€â™‚ï¸ ThÃªm thÃ nh viÃªn</h3>

      <label>Chá»n tour:
        <select id="tv-tour-select" onchange="onChangeTourInThemTv()"></select>
      </label>

      <label>Há» vÃ  tÃªn thÃ nh viÃªn:
        <input type="text" id="tv-ten" placeholder="Nguyá»…n VÄƒn A" />
      </label>

      <label>Sá»‘ Ä‘iá»‡n thoáº¡i:
        <input type="text" id="tv-sdt" placeholder="0978xxxxxx" />
      </label>

      <label>Tá»‰ lá»‡ Ä‘Ã³ng gÃ³p (%):
        <input type="number" id="tv-tyle" placeholder="100" min="0" max="100" value="100" />
      </label>

      <label>Ghi chÃº:
        <textarea id="tv-ghichu" rows="2" style="width: 100%; padding: 6px; font-size: 16px;"></textarea>
      </label>

      <div class="modal-actions">
        <button onclick="submitThemThanhVien()">â• LÆ°u</button>
        <button class="btn-cancel" onclick="closeThemThanhVien()">ğŸ”™ Huá»·</button>
      </div>
    </div>
  </div>



  <!-- Form Sá»­a ThÃ nh viÃªn -->
  <div id="suaTvModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>âœï¸ Sá»­a thÃ´ng tin thÃ nh viÃªn</h3>

      <label>Chá»n tour:
        <select id="edit-tv-tour" onchange="loadThanhVienForEdit(); onChangeTourInSuaTv();"></select>
      </label>

      <label>Chá»n thÃ nh viÃªn:
        <select id="edit-tv-select" onchange="fillOldThanhVienInfo()"></select>
      </label>

      <label>Há» vÃ  tÃªn:
        <input type="text" id="edit-tv-name" placeholder="Nháº­p tÃªn má»›i..." />
      </label>

      <label>Sá»‘ Ä‘iá»‡n thoáº¡i:
        <input type="text" id="edit-tv-sdt" placeholder="0978xxxxxx" />
      </label>

      <label>Tá»‰ lá»‡ Ä‘Ã³ng gÃ³p (%):
        <input type="number" id="edit-tv-tyle" min="0" max="100" />
      </label>

      <label>Ghi chÃº:
        <textarea id="edit-tv-ghichu" rows="2" style="width: 100%; padding: 6px; font-size: 16px;"></textarea>
      </label>

      <div class="modal-actions">
        <button onclick="submitSuaThanhVien()">âœï¸ Cáº­p nháº­t</button>
        <button class="btn-cancel" onclick="closeSuaThanhVien()">ğŸ”™ Huá»·</button>
      </div>
    </div>
  </div>



  <!-- Form XÃ³a ThÃ nh viÃªn -->
  <div id="xoaTvModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ™…â€â™‚ï¸ XÃ³a thÃ nh viÃªn</h3>

      <label>Chá»n tour:
        <select id="xoa-tv-tour" onchange="loadThanhVienForXoa(); onChangeTourInXoaTv();"></select>
      </label>

      <label>Chá»n thÃ nh viÃªn:
        <select id="xoa-tv-select"></select>
      </label>

      <div class="modal-actions">
        <button onclick="submitXoaThanhVien()">ğŸ—‘ï¸ XÃ³a</button>
        <button class="btn-cancel" onclick="closeXoaThanhVien()">ğŸ”™ Huá»·</button>
      </div>
    </div>
  </div>



  <!-- Form Sá»­a ngÃ y Ä‘iá»ƒm danh -->
  <div id="suaNgayModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ“† Sá»­a ngÃ y Ä‘iá»ƒm danh</h3>

      <label>Chá»n lá»›p:
        <select id="sua-ngay-class" onchange="loadDatesForClass()"></select>
      </label>

      <label>Chá»n ngÃ y cáº§n sá»­a:
        <select id="sua-ngay-cu"></select>
      </label>

      <label>NgÃ y má»›i:
        <input type="date" id="sua-ngay-moi" />
      </label>

      <div class="modal-actions">
        <button onclick="submitSuaNgay()">âœï¸ Sá»­a</button>
        <button onclick="submitXoaNgay()">ğŸ—‘ï¸ XÃ³a</button>
        <button class="btn-cancel" onclick="closeSuaNgay()">ğŸ”™ Huá»·</button>
      </div>
    </div>
  </div>

  <!-- Khung theo dÃµi thu há»c phÃ­ -->
  <div id="hophithongke">
    <div class="thongke-container">

      <!-- HÃ ng "ÄÃ£ thu" -->
      <div class="thongke-row">
        <button id="btn-dathu" class="thongke-button same-width">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up-icon lucide-thumbs-up"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"/></svg>
          <span style="padding-left: 6px;">ÄÃ£ thu</span></button>
        <div class="thongke-info">
          <span id="count-dathu">0</span> há»c sinh â€“ Sá»‘ tiá»n: <span id="sum-dathu">0 Ä‘</span>
        </div>
      </div>

      <!-- HÃ ng "ChÆ°a thu" -->
      <div class="thongke-row">
        <button id="btn-chuathu" class="thongke-button same-width">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-down-icon lucide-thumbs-down"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"/></svg>
          <span style="padding-left: 6px;">ChÆ°a thu</span></button>
        <div class="thongke-info">
          <span id="count-chuathu">0</span> há»c sinh â€“ Sá»‘ tiá»n: <span id="sum-chuathu">0 Ä‘</span>
        </div>
      </div>

      <!-- Thanh progress bar -->
      <div class="progress-wrapper">
        <div class="bubble-progress-container">
          <div class="percent-label" id="progress-label">%</div>
          <div class="progress-bar-bg">
            <div id="progress-bar" class="progress-bar-fill"></div>
          </div>
        </div>
      </div>

    </div>
  </div>


  <!-- Form Thu há»c phÃ­ -->
  <div id="thuModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ’° Thu há»c phÃ­</h3>

      <label>Chá»n lá»›p:
        <select id="thu-class" onchange="onChangeClassInThu()"></select>
      </label>

      <label>Chá»n há»c sinh:
        <select id="thu-student" onchange="updateTienThuHocPhi()"></select>
      </label>

      <label>Sá»‘ tiá»n cáº§n thu:
        <input type="text" id="thu-money" readonly />
      </label>

      <div class="modal-actions">
        <button onclick="submitThuHocPhi()">ğŸ¤‘ Thu</button>
        <button class="btn-boqua" onclick="skipThuHocPhi()">â­ Bá» qua</button>
        <button class="btn-cancel" onclick="closeThuHocPhi()">ğŸ”™ Huá»·</button>
      </div>

      <div class="status-bar-thuhocphi">
        Thu há»c phÃ­ khi káº¿t thÃºc lá»›p há»c.<br/>
        Sau Ä‘Ã³ cáº§n táº¡o lá»›p há»c má»›i.
      </div>

    </div>
  </div>

  <!-- Form HÆ°á»›ng dáº«n back up -->
  <div id="backupModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ“¦ HÆ°á»›ng dáº«n sao lÆ°u</h3>
      <p>
        Chá»n <b>LÆ°u vÃ o Tá»‡p
          <span style="display:inline-block; vertical-align:middle; margin-left:6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-folder-closed-icon lucide-folder-closed">
              <path
                d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z" />
              <path d="M2 10h20" />
            </svg>
          </span>
        </b>
        â” Chá»n vá»‹ trÃ­ vÃ  báº¥m <b><span style="color: #0051ff;">LÆ°u</span></b>
      </p>
      <div class="modal-actions">
        <button onclick="closeBackupModal(true)">Tiáº¿p tá»¥c</button>
        <button class="btn-cancel" onclick="closeBackupModal(false)">Huá»·</button>
      </div>
    </div>
  </div>


  <!-- Form hÆ°á»›ng dáº«n thÃªm á»©ng dá»¥ng vÃ o mÃ n hÃ¬nh chÃ­nh -->
  <div id="addtoscreenios" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="font-size: 18px;">
      <h3>ğŸ“² HÆ°á»›ng dáº«n thÃªm á»©ng dá»¥ng <br> vÃ o mÃ n hÃ¬nh chÃ­nh</h3>
      <span style="margin-left: 30px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin: 0 6px;">
        <path d="M12 2v13"/><path d="m16 6-4-4-4 4"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
      </svg>
      Chia sáº»</span><br>
      <span style="margin-left: 30px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin: 0 6px;">
        <rect width="18" height="18" x="3" y="3" rx="2"/>
        <path d="M8 12h8"/><path d="M12 8v8"/>
      </svg>
      ThÃªm vÃ o MÃ n hÃ¬nh chÃ­nh
      </span>
      <div class="modal-actions">
        <button onclick="closeAddToScreenModal(true)">ÄÃ£ hiá»ƒu</button>
        <button class="btn-cancel" onclick="closeAddToScreenModal(false)">Huá»·</button>
      </div>
    </div>
  </div>

  <div id="addtoscreenadr" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="font-size: 18px;">
      <h3>ğŸ“² ThÃªm á»©ng dá»¥ng <br> vÃ o mÃ n hÃ¬nh chÃ­nh</h3>
      <span>Sau khi báº¥m ThÃªm hÃ£y sá»­ dá»¥ng á»©ng dá»¥ng táº¡i mÃ n hÃ¬nh chÃ­nh</span>      
      <div class="modal-actions">
        <button onclick="closeAddToScreenModal(true)">ThÃªm</button>
        <button class="btn-cancel" onclick="closeAddToScreenModal(false)">Huá»·</button>
      </div>
    </div>
  </div>  


  <footer style="text-align: center; font-size: 14px; color: #333; padding: 10px 0 5px;">
    <hr style="border: none; border-top: 1px solid gray; margin-bottom: 10px;" />
    Â© 06/2025<strong> BÃ¹i Tiáº¿n CÃ´ng</strong> â€“ buitiencong@gmail.com
  </footer>

</body>
</html>
